# ê¸°ë³¸

`event-tracker`ì˜ ê¸°ë³¸ì ì¸ ì‚¬ìš©ë²•ê³¼ í•µì‹¬ ê°œë…ì„ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤. ì´ ê°€ì´ë“œë¥¼ í†µí•´ ì„ ì–¸ì  ì´ë²¤íŠ¸ íŠ¸ë˜í‚¹ì˜ ê°•ë ¥í•¨ì„ ê²½í—˜í•´ë³´ì„¸ìš”.

## ë¹ ë¥¸ ì‹œì‘

### 1. ê¸°ë³¸ ì„¤ì •

```tsx
import { createTracker } from "@offlegacy/event-tracker";

// íŠ¸ë˜ì»¤ ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
const [Track, useTracker] = createTracker({
  // ì´ˆê¸°í™” í•¨ìˆ˜
  init: (initialContext, setContext) => {
    // ì„¸ì…˜ ID ìƒì„±
    const sessionId = `session_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
    setContext({ ...initialContext, sessionId });
  },

  // ì´ë²¤íŠ¸ ì „ì†¡ í•¨ìˆ˜
  send: (params, context) => {
    console.log("ì´ë²¤íŠ¸ ì „ì†¡:", params, context);
    // ì‹¤ì œ ì• ë„ë¦¬í‹±ìŠ¤ ì„œë¹„ìŠ¤ë¡œ ì „ì†¡
    analytics.track(params.eventName, {
      ...params,
      userId: context.userId,
      sessionId: context.sessionId,
      timestamp: Date.now(),
    });
  },

  // DOM ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
  DOMEvents: {
    onClick: (params, context) => {
      console.log("í´ë¦­ ì´ë²¤íŠ¸:", params, context);
    },
  },

  // ë…¸ì¶œ ì´ë²¤íŠ¸ ì„¤ì •
  impression: {
    onImpression: (params, context) => {
      console.log("ë…¸ì¶œ ì´ë²¤íŠ¸:", params, context);
    },
    options: {
      threshold: 0.5, // 50% ì´ìƒ ë³´ì¼ ë•Œ íŠ¸ë¦¬ê±°
      freezeOnceVisible: true, // í•œ ë²ˆ ë³´ì´ë©´ ë” ì´ìƒ íŠ¸ë¦¬ê±°í•˜ì§€ ì•ŠìŒ
    },
  },

  // í˜ì´ì§€ ë·° ì„¤ì •
  pageView: {
    onPageView: (params, context) => {
      console.log("í˜ì´ì§€ ë·°:", params, context);
    },
  },
});

export { Track, useTracker };
```

### 2. ê¸°ë³¸ ì‚¬ìš©ë²•

```tsx
// App.tsx
import { Track, useTracker } from "./tracker";

function App() {
  return (
    <Track.Provider initialContext={{ userId: "user-123" }}>
      <HomePage />
    </Track.Provider>
  );
}

function HomePage() {
  const { track } = useTracker();

  const handleCustomEvent = async () => {
    await track({
      eventName: "custom_action",
      category: "engagement",
      action: "button_click",
      label: "homepage_cta",
      value: 1,
    });
  };

  return (
    <div>
      <h1>í™ˆí˜ì´ì§€</h1>

      {/* í˜ì´ì§€ ë·° ìë™ íŠ¸ë˜í‚¹ */}
      <Track.PageView
        params={{
          pagePath: "/",
          pageTitle: "í™ˆí˜ì´ì§€",
          category: "main",
        }}
      />

      {/* ë²„íŠ¼ í´ë¦­ íŠ¸ë˜í‚¹ */}
      <Track.Click
        params={{
          buttonId: "cta-button",
          buttonText: "ì‹œì‘í•˜ê¸°",
          category: "conversion",
        }}
      >
        <button onClick={handleCustomEvent}>ì‹œì‘í•˜ê¸°</button>
      </Track.Click>

      {/* ë°°ë„ˆ ë…¸ì¶œ íŠ¸ë˜í‚¹ */}
      <Track.Impression
        params={{
          elementId: "hero-banner",
          elementType: "banner",
          visibilityPercentage: 80,
        }}
      >
        <div className="hero-banner">
          <h2>í™˜ì˜í•©ë‹ˆë‹¤!</h2>
          <p>ìƒˆë¡œìš´ ê²½í—˜ì„ ì‹œì‘í•´ë³´ì„¸ìš”.</p>
        </div>
      </Track.Impression>
    </div>
  );
}
```

## í•µì‹¬ ì»´í¬ë„ŒíŠ¸

### 1. Track.Provider

íŠ¸ë˜í‚¹ ì»¨í…ìŠ¤íŠ¸ë¥¼ ì œê³µí•˜ëŠ” ìµœìƒìœ„ ì»´í¬ë„ŒíŠ¸ì…ë‹ˆë‹¤.

```tsx
<Track.Provider
  initialContext={{
    userId: "user-123",
    userType: "premium",
    trackingConsent: true,
    page: "homepage",
  }}
>
  {/* ìì‹ ì»´í¬ë„ŒíŠ¸ë“¤ */}
</Track.Provider>
```

**ì£¼ìš” ì†ì„±:**

- `initialContext`: ì´ˆê¸° ì»¨í…ìŠ¤íŠ¸ ê°ì²´
- `enabled`: íŠ¸ë˜í‚¹ í™œì„±í™” ì—¬ë¶€ (ê¸°ë³¸ê°’: true)

### 2. Track.Click

í´ë¦­ ì´ë²¤íŠ¸ë¥¼ ìë™ìœ¼ë¡œ íŠ¸ë˜í‚¹í•˜ëŠ” ì»´í¬ë„ŒíŠ¸ì…ë‹ˆë‹¤.

```tsx
<Track.Click
  params={{
    buttonId: "submit-button",
    buttonText: "ì œì¶œ",
    category: "form",
    action: "submit",
  }}
  enabled={(context) => context.trackingConsent}
  debounce={{ delay: 300 }}
>
  <button>ì œì¶œ</button>
</Track.Click>
```

**ì£¼ìš” ì†ì„±:**

- `params`: ì´ë²¤íŠ¸ íŒŒë¼ë¯¸í„° (ê°ì²´ ë˜ëŠ” í•¨ìˆ˜)
- `enabled`: íŠ¸ë˜í‚¹ í™œì„±í™” ì¡°ê±´
- `debounce`: ë””ë°”ìš´ìŠ¤ ì„¤ì •
- `throttle`: ìŠ¤ë¡œí‹€ ì„¤ì •

### 3. Track.Impression

ìš”ì†Œê°€ í™”ë©´ì— ë…¸ì¶œë  ë•Œ íŠ¸ë˜í‚¹í•˜ëŠ” ì»´í¬ë„ŒíŠ¸ì…ë‹ˆë‹¤.

```tsx
<Track.Impression
  params={{
    elementId: "product-card-1",
    elementType: "product",
    position: 1,
    category: "product_list",
  }}
  options={{
    threshold: 0.5,
    freezeOnceVisible: true,
    rootMargin: "0px 0px -100px 0px",
  }}
>
  <div className="product-card">
    <img src="/product1.jpg" alt="ìƒí’ˆ 1" />
    <h3>ìƒí’ˆëª…</h3>
    <p>â‚©29,900</p>
  </div>
</Track.Impression>
```

**ì£¼ìš” ì†ì„±:**

- `params`: ì´ë²¤íŠ¸ íŒŒë¼ë¯¸í„°
- `options`: Intersection Observer ì˜µì…˜
- `enabled`: íŠ¸ë˜í‚¹ í™œì„±í™” ì¡°ê±´

### 4. Track.PageView

í˜ì´ì§€ ë·°ë¥¼ ìë™ìœ¼ë¡œ íŠ¸ë˜í‚¹í•˜ëŠ” ì»´í¬ë„ŒíŠ¸ì…ë‹ˆë‹¤.

```tsx
<Track.PageView
  params={{
    pagePath: "/products",
    pageTitle: "ìƒí’ˆ ëª©ë¡",
    category: "product",
    referrer: document.referrer,
  }}
/>
```

## ì‹¤ì œ ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤

### 1. ì „ììƒê±°ë˜ ì‚¬ì´íŠ¸

```tsx
// components/ProductList.tsx
import { Track, useTracker } from "../tracker";

function ProductList({ products }) {
  const { track } = useTracker();

  const handleAddToCart = async (product) => {
    try {
      // ì¥ë°”êµ¬ë‹ˆ ì¶”ê°€ ë¡œì§
      await addToCart(product.id);

      // íŠ¸ë˜í‚¹
      await track({
        eventName: "add_to_cart",
        productId: product.id,
        productName: product.name,
        price: product.price,
        currency: "KRW",
        quantity: 1,
        category: product.category,
      });
    } catch (error) {
      console.error("ì¥ë°”êµ¬ë‹ˆ ì¶”ê°€ ì‹¤íŒ¨:", error);
    }
  };

  return (
    <Track.Provider initialContext={{ userId: "user-123", page: "product-list" }}>
      {/* í˜ì´ì§€ ë·° íŠ¸ë˜í‚¹ */}
      <Track.PageView
        params={{
          pagePath: "/products",
          category: "product_list",
          productCount: products.length,
        }}
      />

      <div className="product-grid">
        {products.map((product, index) => (
          <Track.Impression
            key={product.id}
            params={{
              productId: product.id,
              position: index + 1,
              elementType: "product",
              category: product.category,
            }}
          >
            <div className="product-card">
              <img src={product.image} alt={product.name} />
              <h3>{product.name}</h3>
              <p>â‚©{product.price.toLocaleString()}</p>

              {/* ì¥ë°”êµ¬ë‹ˆ ë²„íŠ¼ */}
              <Track.Click
                params={{
                  productId: product.id,
                  action: "add_to_cart",
                  price: product.price,
                  position: index + 1,
                }}
              >
                <button onClick={() => handleAddToCart(product)}>ì¥ë°”êµ¬ë‹ˆ ë‹´ê¸°</button>
              </Track.Click>

              {/* ìƒì„¸ë³´ê¸° ë²„íŠ¼ */}
              <Track.Click
                params={{
                  productId: product.id,
                  action: "view_detail",
                  position: index + 1,
                }}
              >
                <button>ìƒì„¸ë³´ê¸°</button>
              </Track.Click>
            </div>
          </Track.Impression>
        ))}
      </div>
    </Track.Provider>
  );
}
```

### 2. ë¸”ë¡œê·¸/ì½˜í…ì¸  ì‚¬ì´íŠ¸

```tsx
// components/BlogPost.tsx
import { Track, useTracker } from "../tracker";

function BlogPost({ post }) {
  const { track } = useTracker();

  const handleShare = async (platform) => {
    await track({
      eventName: "share_article",
      articleId: post.id,
      articleTitle: post.title,
      platform: platform,
      category: "social_sharing",
    });
  };

  const handleComment = async () => {
    await track({
      eventName: "comment_article",
      articleId: post.id,
      category: "engagement",
    });
  };

  return (
    <Track.Provider initialContext={{ userId: "user-123", articleId: post.id }}>
      {/* í˜ì´ì§€ ë·° íŠ¸ë˜í‚¹ */}
      <Track.PageView
        params={{
          pagePath: `/blog/${post.id}`,
          pageTitle: post.title,
          category: "blog",
          author: post.author,
          publishDate: post.publishDate,
        }}
      />

      <article>
        <h1>{post.title}</h1>
        <p>ì‘ì„±ì: {post.author}</p>

        {/* ë³¸ë¬¸ ë…¸ì¶œ íŠ¸ë˜í‚¹ */}
        <Track.Impression
          params={{
            elementId: "article-content",
            elementType: "content",
            category: "blog_content",
          }}
        >
          <div className="article-content">{post.content}</div>
        </Track.Impression>

        {/* ê³µìœ  ë²„íŠ¼ë“¤ */}
        <div className="share-buttons">
          <Track.Click
            params={{
              action: "share",
              platform: "facebook",
              articleId: post.id,
            }}
          >
            <button onClick={() => handleShare("facebook")}>Facebook ê³µìœ </button>
          </Track.Click>

          <Track.Click
            params={{
              action: "share",
              platform: "twitter",
              articleId: post.id,
            }}
          >
            <button onClick={() => handleShare("twitter")}>Twitter ê³µìœ </button>
          </Track.Click>
        </div>

        {/* ëŒ“ê¸€ ë²„íŠ¼ */}
        <Track.Click
          params={{
            action: "comment",
            articleId: post.id,
          }}
        >
          <button onClick={handleComment}>ëŒ“ê¸€ ì‘ì„±</button>
        </Track.Click>
      </article>
    </Track.Provider>
  );
}
```

### 3. í¼ ë° ì‚¬ìš©ì ì…ë ¥

```tsx
// components/ContactForm.tsx
import { Track, useTracker } from "../tracker";
import { useState } from "react";

function ContactForm() {
  const { track } = useTracker();
  const [formData, setFormData] = useState({
    name: "",
    email: "",
    message: "",
  });

  const handleSubmit = async (e) => {
    e.preventDefault();

    try {
      // í¼ ì œì¶œ ë¡œì§
      await submitForm(formData);

      // ì„±ê³µ íŠ¸ë˜í‚¹
      await track({
        eventName: "form_submit",
        formId: "contact-form",
        formType: "contact",
        fieldCount: Object.keys(formData).length,
        category: "conversion",
      });
    } catch (error) {
      // ì‹¤íŒ¨ íŠ¸ë˜í‚¹
      await track({
        eventName: "form_error",
        formId: "contact-form",
        errorType: error.message,
        category: "error",
      });
    }
  };

  return (
    <Track.Provider initialContext={{ userId: "user-123", formId: "contact-form" }}>
      <form onSubmit={handleSubmit}>
        {/* ì´ë¦„ ì…ë ¥ í•„ë“œ */}
        <Track.Click
          params={{
            action: "focus_field",
            fieldName: "name",
            formId: "contact-form",
          }}
        >
          <input
            type="text"
            name="name"
            value={formData.name}
            onChange={(e) => setFormData({ ...formData, name: e.target.value })}
            placeholder="ì´ë¦„"
          />
        </Track.Click>

        {/* ì´ë©”ì¼ ì…ë ¥ í•„ë“œ */}
        <Track.Click
          params={{
            action: "focus_field",
            fieldName: "email",
            formId: "contact-form",
          }}
        >
          <input
            type="email"
            name="email"
            value={formData.email}
            onChange={(e) => setFormData({ ...formData, email: e.target.value })}
            placeholder="ì´ë©”ì¼"
          />
        </Track.Click>

        {/* ë©”ì‹œì§€ ì…ë ¥ í•„ë“œ */}
        <Track.Click
          params={{
            action: "focus_field",
            fieldName: "message",
            formId: "contact-form",
          }}
        >
          <textarea
            name="message"
            value={formData.message}
            onChange={(e) => setFormData({ ...formData, message: e.target.value })}
            placeholder="ë©”ì‹œì§€"
          />
        </Track.Click>

        {/* ì œì¶œ ë²„íŠ¼ */}
        <Track.Click
          params={{
            action: "submit_form",
            formId: "contact-form",
            fieldCount: Object.keys(formData).length,
          }}
        >
          <button type="submit">ì œì¶œ</button>
        </Track.Click>
      </form>
    </Track.Provider>
  );
}
```

## ì„±ëŠ¥ ìµœì í™”

### 1. ì¡°ê±´ë¶€ íŠ¸ë˜í‚¹

```tsx
// ì‚¬ìš©ì íƒ€ì…ì— ë”°ë¥¸ ì¡°ê±´ë¶€ íŠ¸ë˜í‚¹
<Track.Click
  params={{ feature: "premium-download" }}
  enabled={(context) => context.userType === "premium"}
>
  <button>í”„ë¦¬ë¯¸ì—„ ë‹¤ìš´ë¡œë“œ</button>
</Track.Click>

// íŠ¸ë˜í‚¹ ë™ì˜ì— ë”°ë¥¸ ì¡°ê±´ë¶€ íŠ¸ë˜í‚¹
<Track.Click
  params={{ action: "tracking_consent" }}
  enabled={(context) => context.trackingConsent}
>
  <button>ë™ì˜í•˜ê¸°</button>
</Track.Click>

// í™˜ê²½ì— ë”°ë¥¸ ì¡°ê±´ë¶€ íŠ¸ë˜í‚¹
<Track.Click
  params={{ action: "debug_action" }}
  enabled={() => process.env.NODE_ENV === "development"}
>
  <button>ë””ë²„ê·¸ ì•¡ì…˜</button>
</Track.Click>
```

### 2. ë””ë°”ìš´ìŠ¤ì™€ ìŠ¤ë¡œí‹€

```tsx
// ê²€ìƒ‰ ì…ë ¥ ë””ë°”ìš´ìŠ¤
<Track.Click
  params={{ action: "search" }}
  debounce={{ delay: 300, leading: false, trailing: true }}
>
  <button>ê²€ìƒ‰</button>
</Track.Click>

// ë¹ ë¥¸ ì•¡ì…˜ ìŠ¤ë¡œí‹€
<Track.Click
  params={{ action: "rapid_action" }}
  throttle={{ delay: 1000, leading: true, trailing: false }}
>
  <button>ë¹ ë¥¸ ì•¡ì…˜</button>
</Track.Click>

// ìŠ¤í¬ë¡¤ ì´ë²¤íŠ¸ ìŠ¤ë¡œí‹€
<Track.Click
  params={{ action: "scroll" }}
  throttle={{ delay: 100, leading: false, trailing: true }}
>
  <div className="scrollable-content">
    {/* ìŠ¤í¬ë¡¤ ê°€ëŠ¥í•œ ì½˜í…ì¸  */}
  </div>
</Track.Click>
```

### 3. ë™ì  íŒŒë¼ë¯¸í„°

```tsx
// ì»¨í…ìŠ¤íŠ¸ ê¸°ë°˜ ë™ì  íŒŒë¼ë¯¸í„°
<Track.Click
  params={(context) => ({
    action: "custom_action",
    userId: context.userId,
    timestamp: Date.now(),
    userType: context.userType,
    page: context.page
  })}
>
  <button>ë™ì  ì•¡ì…˜</button>
</Track.Click>

// ì´ë²¤íŠ¸ ê¸°ë°˜ ë™ì  íŒŒë¼ë¯¸í„°
<Track.Click
  params={(context, event) => ({
    action: "button_click",
    buttonId: event.target.id,
    buttonText: event.target.textContent,
    clickX: event.clientX,
    clickY: event.clientY,
    timestamp: Date.now()
  })}
>
  <button id="dynamic-button">ë™ì  ë²„íŠ¼</button>
</Track.Click>
```

## useTracker í›… í™œìš©

### 1. ê¸°ë³¸ ì‚¬ìš©ë²•

```tsx
function AdvancedComponent() {
  const { track, context, setContext } = useTracker();

  const handleComplexAction = async () => {
    try {
      // ë³µì¡í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
      const result = await processComplexAction();

      // ì„±ê³µ íŠ¸ë˜í‚¹
      await track({
        eventName: "complex_action_completed",
        result: result.status,
        duration: result.duration,
        userId: context.userId,
        sessionId: context.sessionId,
      });

      // ì»¨í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
      setContext({
        ...context,
        lastAction: result,
        actionCount: (context.actionCount || 0) + 1,
      });
    } catch (error) {
      // ì—ëŸ¬ íŠ¸ë˜í‚¹
      await track({
        eventName: "complex_action_failed",
        error: error.message,
        userId: context.userId,
      });
    }
  };

  return (
    <div>
      <button onClick={handleComplexAction}>ë³µì¡í•œ ì•¡ì…˜</button>
      <p>ì•¡ì…˜ íšŸìˆ˜: {context.actionCount || 0}</p>
    </div>
  );
}
```

### 2. ë°°ì¹˜ íŠ¸ë˜í‚¹

```tsx
function BatchTrackingExample() {
  const { track } = useTracker();

  const handleBatchAction = async () => {
    const events = [
      { eventName: "step_1", step: 1 },
      { eventName: "step_2", step: 2 },
      { eventName: "step_3", step: 3 },
    ];

    // ìˆœì°¨ì  íŠ¸ë˜í‚¹
    for (const event of events) {
      await track(event);
      await new Promise((resolve) => setTimeout(resolve, 100)); // ì§€ì—°
    }

    // ë˜ëŠ” ë³‘ë ¬ íŠ¸ë˜í‚¹
    await Promise.all(events.map((event) => track(event)));
  };

  return <button onClick={handleBatchAction}>ë°°ì¹˜ ì•¡ì…˜</button>;
}
```

## ì—ëŸ¬ ì²˜ë¦¬ ë° ë””ë²„ê¹…

### 1. ì—ëŸ¬ ì²˜ë¦¬

```tsx
const [Track, useTracker] = createTracker({
  send: async (params, context) => {
    try {
      await analytics.track(params.eventName, {
        ...params,
        userId: context.userId,
        timestamp: Date.now(),
      });
    } catch (error) {
      console.error("íŠ¸ë˜í‚¹ ì—ëŸ¬:", error);

      // ì—ëŸ¬ ì¶”ì  ì„œë¹„ìŠ¤ë¡œ ì „ì†¡
      errorTracking.captureException(error);

      // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥í•˜ì—¬ ë‚˜ì¤‘ì— ì¬ì „ì†¡
      saveFailedEvent(params, context);
    }
  },
});

// ì‹¤íŒ¨í•œ ì´ë²¤íŠ¸ ì €ì¥
const saveFailedEvent = (params, context) => {
  try {
    const failedEvents = JSON.parse(localStorage.getItem("failedEvents") || "[]");
    failedEvents.push({ params, context, timestamp: Date.now() });
    localStorage.setItem("failedEvents", JSON.stringify(failedEvents.slice(-50))); // ìµœëŒ€ 50ê°œ
  } catch (error) {
    console.error("ì‹¤íŒ¨í•œ ì´ë²¤íŠ¸ ì €ì¥ ì‹¤íŒ¨:", error);
  }
};
```

### 2. ë””ë²„ê¹… ëª¨ë“œ

```tsx
const [Track, useTracker] = createTracker({
  send: (params, context) => {
    // ê°œë°œ í™˜ê²½ì—ì„œ ìƒì„¸ ë¡œê¹…
    if (process.env.NODE_ENV === "development") {
      console.group("ğŸ” ì´ë²¤íŠ¸ íŠ¸ë˜í‚¹");
      console.log("ì´ë²¤íŠ¸ëª…:", params.eventName);
      console.log("íŒŒë¼ë¯¸í„°:", params);
      console.log("ì»¨í…ìŠ¤íŠ¸:", context);
      console.log("íƒ€ì„ìŠ¤íƒ¬í”„:", new Date().toISOString());
      console.groupEnd();
    }

    // ì‹¤ì œ íŠ¸ë˜í‚¹ ë¡œì§
    analytics.track(params.eventName, {
      ...params,
      userId: context.userId,
      timestamp: Date.now(),
    });
  },
});
```

### 3. ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§

```tsx
const [Track, useTracker] = createTracker({
  send: async (params, context) => {
    const startTime = performance.now();

    try {
      await analytics.track(params.eventName, {
        ...params,
        userId: context.userId,
        timestamp: Date.now(),
      });

      const duration = performance.now() - startTime;

      // ì„±ëŠ¥ ë©”íŠ¸ë¦­ ê¸°ë¡
      if (duration > 1000) {
        // 1ì´ˆ ì´ìƒ ê±¸ë¦° ê²½ìš°
        console.warn("ëŠë¦° íŠ¸ë˜í‚¹:", params.eventName, duration);
      }
    } catch (error) {
      const duration = performance.now() - startTime;
      console.error("íŠ¸ë˜í‚¹ ì‹¤íŒ¨:", params.eventName, duration, error);
    }
  },
});
```
